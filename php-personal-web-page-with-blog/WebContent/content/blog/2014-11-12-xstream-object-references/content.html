<p>
	<a href="http://xstream.codehaus.org">XStream</a> is a simple java library to serialize objects to XML and back again.
</p>

<p>
	But how does XStream deals with duplicate and circular references?
	<br>
	By default is using XPath to allow serialized objects to be treated as graphs instead of simple trees (typical XML usage).
</p>

<p>
	The objects:
</p>

<pre>
public class Contact {

  private String name;

  private List&lt;Address&gt; addresses;

  public Contact(String name, Address... addresses) {
    this.name = name;
    this.addresses = new ArrayList&lt;Address&gt;(Arrays.asList(addresses));
  }

  public Contact(String name, List&lt;Address&gt; addresses) {
    this.name = name;
    this.addresses = addresses;
  }

  // ... other constructors and methods
}
</pre>

<pre>
public class Address {

  private String street;
  private String city;

  public Address(String street, String city) {
    this.street = street;
    this.city = city;
  }

  // ... other constructors and methods
}
</pre>

<p>
	The test code:
</p>

<pre>
public static void main(String[] args) {

  XStream xStream = new XStream(new DomDriver());

  xStream.alias(&quot;contact&quot;, Contact.class);
  xStream.alias(&quot;address&quot;, Address.class);

  Address address = new Address(&quot;My Street&quot;, &quot;Bucharest&quot;);

  Contact contact = new Contact(&quot;Cristian Sulea&quot;, address, address);

  xStream.toXML(contact, System.out);
}
</pre>

<h3>XPath Relative</h3>

<p>
	If we execute the test code, XStream's uses its default mode called <code>XPATH_RELATIVE_REFERENCES</code> based on the W3C XPath specification:
</p>

<pre>
&lt;contact&gt;
  &lt;name&gt;Cristian Sulea&lt;/name&gt;
  &lt;addresses&gt;
    &lt;address&gt;
      &lt;street&gt;My Street&lt;/street&gt;
      &lt;city&gt;Bucharest&lt;/city&gt;
    &lt;/address&gt;
    &lt;address reference=&quot;../address&quot; /&gt;
  &lt;/addresses&gt;
&lt;/contact&gt;
</pre>

<p>
	The explicit call is:
</p>

<pre>
xStream.setMode(XStream.XPATH_RELATIVE_REFERENCES);
</pre>

<h3>XPath Absolute</h3>

<p>
	There is also an absolute mode which is easy to use and understand:
</p>

<pre>
xStream.setMode(XStream.XPATH_ABSOLUTE_REFERENCES);
</pre>

<p>
	In this case the resulting XML is:
</p>

<pre>
&lt;contact&gt;
    &lt;name&gt;Cristian Sulea&lt;/name&gt;
    &lt;addresses&gt;
        &lt;address&gt;
            &lt;street&gt;My Street&lt;/street&gt;
            &lt;city&gt;Bucharest&lt;/city&gt;
        &lt;/address&gt;
        &lt;address reference=&quot;/contact/addresses/address&quot;/&gt;
    &lt;/addresses&gt;
&lt;/contact&gt;
</pre>

<h3>Single Node Selectors</h3>

<p>
	In some cases where the XML is used later on or is generated by someone else, the XPath selectors can be forced
	to select always a single node instead of a node list where the first element is taken.
<p>

<p>
	Therefore two more modes exist:
</p>

<pre>
xStream.setMode(XStream.SINGLE_NODE_XPATH_ABSOLUTE_REFERENCES);
</pre>

<p>
	with resulting XML
</p>

<pre>
&lt;contact&gt;
  &lt;name&gt;Cristian Sulea&lt;/name&gt;
  &lt;addresses&gt;
    &lt;address&gt;
      &lt;street&gt;My Street&lt;/street&gt;
      &lt;city&gt;Bucharest&lt;/city&gt;
    &lt;/address&gt;
    &lt;address reference=&quot;/contact[1]/addresses[1]/address[1]&quot; /&gt;
  &lt;/addresses&gt;
&lt;/contact&gt;
</pre>

<p>
	and
</p>

<pre>
xStream.setMode(XStream.SINGLE_NODE_XPATH_RELATIVE_REFERENCES);
</pre>

<p>
	with resulting XML
</p>

<pre>
&lt;contact&gt;
  &lt;name&gt;Cristian Sulea&lt;/name&gt;
  &lt;addresses&gt;
    &lt;address&gt;
      &lt;street&gt;My Street&lt;/street&gt;
      &lt;city&gt;Bucharest&lt;/city&gt;
    &lt;/address&gt;
    &lt;address reference=&quot;../address[1]&quot; /&gt;
  &lt;/addresses&gt;
&lt;/contact&gt;
</pre>

<h3>Id Mode</h3>

<p>
	XStream has another mode which makes it is easier to read/write by a human being:
</p>

<pre>
xStream.setMode(XStream.SINGLE_NODE_XPATH_RELATIVE_REFERENCES);
</pre>

<p>
	The result is a XML which generates an <code>id</code> attribute for each new object marshaled, and whenever it finds back or cross-references,
	it uses a <code>reference</code> attribute to so it doesn't copy the entire object:
</p>

<pre>
&lt;contact id=&quot;1&quot;&gt;
  &lt;name&gt;Cristian Sulea&lt;/name&gt;
  &lt;addresses id=&quot;2&quot;&gt;
    &lt;address id=&quot;3&quot;&gt;
      &lt;street&gt;My Street&lt;/street&gt;
      &lt;city&gt;Bucharest&lt;/city&gt;
    &lt;/address&gt;
    &lt;address reference=&quot;3&quot; /&gt;
  &lt;/addresses&gt;
&lt;/contact&gt;
</pre>

<h3>NO References</h3>

<p>
	For some uses of XStream we do not desire any kind of back or cross references like a graph, but a simple tree.
	Remember that in such scenarios it's impossible to represent a graph cycle (no tree contains such structure).
</p>

<pre>
xStream.setMode(XStream.NO_REFERENCES);
</pre>

<p>
	In the resulting XML every reference shall be serialized:
</p>

<pre>
&lt;contact&gt;
  &lt;name&gt;Cristian Sulea&lt;/name&gt;
  &lt;addresses&gt;
    &lt;address&gt;
      &lt;street&gt;My Street&lt;/street&gt;
      &lt;city&gt;Bucharest&lt;/city&gt;
    &lt;/address&gt;
    &lt;address&gt;
      &lt;street&gt;My Street&lt;/street&gt;
      &lt;city&gt;Bucharest&lt;/city&gt;
    &lt;/address&gt;
  &lt;/addresses&gt;
&lt;/contact&gt;
</pre>